#!/bin/bash
# Substitui e flexibiliza o uso do docker-compose,
# existem os parametros padrão mas você pode passar os adicionais que quiser
# no futuro será criado um snippet para esse script

TAG=$(git describe --abbrev=0 --tags)
CONTAINER_NAME="pedido-api"
IMAGE_NAME_DEV="${CONTAINER_NAME}-dev:$TAG"
WWW="/var/www/"

if [ "$1" == "build" ]; then # generate images 

	docker build --rm --tag $IMAGE_NAME_DEV -f ./Dockerfile . "${@:2}"

elif [ "$1" == "up" ]; then # generate containers and run it

	# removing continers with the same name before run it
	docker rm -f $CONTAINER_NAME &> /dev/null 

	# running it with some options
	docker run -d --hostname $CONTAINER_NAME \
		--env WWW=$WWW \
		--volume $PWD/:$WWW \
		--link pedido-mysql:pedido-mysql
		--name $CONTAINER_NAME $IMAGE_NAME_DEV "${@:2}"

elif [ "$1" == "clear" ]; then # delete all the images and containers generated by this script

	echo "deleting the containers..."
	docker rm -f $CONTAINER_NAME &> /dev/null # the output does not matter for me

	echo "deleting images ..."
	docker rmi -f $IMAGE_NAME_DEV &> /dev/null # the output does not matter for me
	echo "done!"

else
	echo "please choose a task (read this script to see the tasks)"
	exit -1
fi